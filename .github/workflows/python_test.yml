# å‚è€ƒï¼šhttps://github.com/Tiryoh/actions-mkdocs
name: Testing
on: [push, pull_request]

jobs:
  build:
    name: Test Python script
    runs-on: ubuntu-latest
    steps:
      - name: Checkout 
        uses: actions/checkout@v2

      # ä»»åŠ¡åç§°ï¼šè®¾ç½®Pythonç¯å¢ƒ
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11' # æŒ‡å®špythonç‰ˆæœ¬ (å·²æ”¹ä¸º 3.11ï¼Œå¾ˆå¥½)
          architecture: 'x64'

      # === ğŸ‘‡ å…³é”®ä¿®æ”¹å¼€å§‹ ğŸ‘‡ ===
      
      # 1. å…ˆå•ç‹¬å®‰è£… CPU ç‰ˆæœ¬çš„ PyTorch
      # åŸå› ï¼šé»˜è®¤çš„ PyTorch åŒ…å«å‡ ä¸ªGBçš„ Nvidia æ˜¾å¡é©±åŠ¨ï¼Œä¼šæŠŠ GitHub çš„ç¡¬ç›˜æ’‘çˆ†ã€‚
      # æŒ‡å®š CPU ç‰ˆæœ¬åï¼Œä½“ç§¯éå¸¸å°ï¼Œå‡ ç§’é’Ÿå°±è£…å¥½äº†ã€‚
      - name: Install CPU-only PyTorch
        run: pip install torch torchvision --index-url https://download.pytorch.org/whl/cpu

      # 2. å†å®‰è£…å‰©ä¸‹çš„ requirements.txt
      # pip ä¼šæ£€æµ‹åˆ° torch å·²ç»å®‰è£…äº†ï¼Œå°±ä¼šè·³è¿‡é‚£ä¸ªå·¨å¤§çš„ GPU ç‰ˆæœ¬ï¼Œä»è€Œè§£å†³ç©ºé—´ä¸è¶³çš„é—®é¢˜ã€‚
      - name: Install Python dependencies
        run: python -m pip install -r requirements.txt
        
      # === ğŸ‘† å…³é”®ä¿®æ”¹ç»“æŸ ğŸ‘† ===

      - name: Python script testing
        run: |
          cd src/chap01_warmup && python numpy_tutorial.py && cd ../..
          cd src/chap02_linear_regression && python exercise-linear_regression.py && cd ../..
          cd src/chap02_linear_regression && python linear_regression-tf2.0.py && cd ../..
          cd src/chap03_softmax_regression  && python logistic_regression-exercise.py  && cd ../..
          cd src/chap03_softmax_regression  && python softmax_regression-exercise.py   && cd ../..
