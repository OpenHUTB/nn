

# 软体人形机器人弹跳动作仿真（基于MuJoCo）

## 项目概述
本项目是一个基于**MuJoCo物理引擎**的软体人形机器人物理仿真示例。实际运行中，机器人会呈现**原地短暂跳起后回落蹲下**的循环动作——这是由于软体机器人的柔性特性（弹性、形变）与控制参数共同作用的结果：关节电机驱动力过强时，软体结构会储存弹性势能，释放时形成向上的弹跳力，随后在重力作用下回落至蹲下姿势，形成往复运动。


## 环境准备
### 依赖库
项目依赖以下Python库，需提前安装：
```bash
pip install mujoco mujoco-viewer
```


## 项目结构
| 文件名         | 功能描述                                                     |
| -------------- | ------------------------------------------------------------ |
| `humanoid.xml` | MJCF格式模型文件，定义软体机器人的结构、关节参数（阻尼、弹性）、关键帧姿势（深蹲、单腿站立）及电机执行器 |
| `main.py`      | 控制主程序，实现模型加载、比例控制逻辑、仿真循环及可视化，驱动机器人运动 |


## 核心文件说明
### 1. `humanoid.xml`（软体机器人模型）
模型的关键特性直接影响弹跳效果：
- **软体物理属性**：关节设置了较低阻尼（`damping`）和一定弹性，允许较大形变（为弹跳提供储能基础）；
- **关键帧姿势**：
  - 索引`0`：`squat`（深蹲姿势）—— 初始状态，关节弯曲储存势能；
  - 索引`1`：`stand_on_left_leg`（单左腿站立）—— 目标姿势，关节伸展；
- **电机参数**：`ctrlrange="-1 1"`限制控制信号范围，但软体弹性会放大实际驱动力，导致动作过冲。


### 2. `main.py`（控制逻辑）
程序通过**比例控制**驱动关节运动，是弹跳动作的直接诱因：
```python
# 核心控制逻辑：计算关节误差，生成驱动信号
qpos_error = target_qpos[7:] - data.qpos[7:]  # 目标与当前关节位置差
data.ctrl[:] = Kp * qpos_error  # 比例增益放大误差，生成电机信号
```
- **参数影响**：代码中`Kp=5.0`的比例增益，对软体机器人而言可能过大——驱动力超过维持姿势所需，导致关节快速伸展，软体结构弹性形变加剧，最终形成“跳起”动作；
- **循环机制**：跳起后重力主导回落，关节位置偏离目标，控制信号再次触发驱动力，形成“跳起→蹲下→再跳起”的循环。


## 实际运行效果解析
1. **初始状态**：机器人从深蹲姿势（`squat`）开始，关节弯曲，软体结构处于压缩状态；
2. **驱动阶段**：控制信号驱动关节向站立姿势（`stand_on_left_leg`）伸展，软体材料因快速形变储存弹性势能；
3. **弹跳阶段**：弹性势能释放，机器人获得向上的力，短暂离开初始位置（跳起）；
4. **回落阶段**：重力作用下，机器人下落，关节在冲击力和控制信号调整下重新弯曲，回到接近深蹲的姿势；
5. **循环往复**：关节位置误差再次增大，控制信号重复驱动，形成周期性弹跳动作。


## 使用步骤
1. 确认`humanoid.xml`与`main.py`在同一目录（默认路径：`src/humanoid_motion_control/`）；
2. 终端执行命令启动仿真：
   ```bash
   python main.py
   ```
3. 可视化窗口将显示机器人的弹跳动作，按`Ctrl+C`终止仿真。


## 参数调整指南（优化动作）
若希望减弱弹跳、实现更平稳的蹲站动作，可调整以下参数：

| 参数名   | 调整方向                              | 效果说明                                                     |
| -------- | ------------------------------------- | ------------------------------------------------------------ |
| `Kp`     | 减小至`1.0~3.0`                       | 降低比例增益，减弱电机驱动力，避免软体结构过度形变和弹性势能积累 |
| 关节阻尼 | 在`humanoid.xml`中增大关节`damping`值 | 增加软体关节的阻尼，消耗部分弹性势能，减少弹跳幅度           |
| 仿真步长 | 减小`time.sleep(0.005)`至`0.002`      | 提高仿真精度，使控制信号更细腻地响应关节位置变化             |


## 常见问题
1. **弹跳幅度过大甚至翻倒**  
   → 解决方案：将`Kp`降至`1.0`，同时在`humanoid.xml`中找到关节节点（如`<joint>`），增大`damping`参数（如从`1.0`改为`5.0`）。

2. **动作卡顿或延迟**  
   → 解决方案：检查`time.sleep()`的数值，若电脑性能较好，可减小至`0.001`以提升流畅度。

3. **模型加载失败**  
   → 解决方案：确认`main.py`中模型路径与`humanoid.xml`实际位置一致，例如修改为：
   ```python
   model = mujoco.MjModel.from_xml_path("humanoid.xml")  # 若文件在当前目录
   ```


## 参考资料
- [MuJoCo物理引擎文档](https://mujoco.readthedocs.io/)：了解软体材料参数（弹性、阻尼）的配置方法
- [比例控制算法详解](https://en.wikipedia.org/wiki/Proportional_control)：理解`Kp`对控制效果的影响

