# 无人车模型预测控制（mpc）

##### 项目概述

这是一个基于Carla仿真环境的模型预测控制（MPC）轨迹跟踪系统。项目包含多种轨迹生成算法（8字形、圆形、螺旋形、直线）和MPC控制器，能够实现自动驾驶车辆在指定轨迹上的精确跟踪控制。

##### 项目结构

├── main.py                    # 主运行文件

├── main\_help\_functions.py     # 轨迹生成和辅助函数

├── main\_mpc\_controller.py     # MPC控制器实现

##### 环境依赖

###### 必需库

\# 基础依赖

numpy>=1.20.0

casadi>=3.5.0

\# Carla仿真（需要Carla 0.9.10+）

\# Carla Python API通常随Carla安装包提供

###### 安装步骤

1.安装Anaconda或Miniconda

2.创建虚拟环境：

conda create -n mpc\_carla python=3.7

conda activate mpc\_carla

3.下载并安装Carla仿真器（建议0.9.10及以上版本）

4.将Carla的Python API添加到Python路径中

###### 运行说明

1\. 启动Carla服务器

\# 在Carla安装目录中

./CarlaUE4.exe

2\. 运行MPC控制器

python main.py

3\. 切换轨迹类型

在main.py中注释/取消注释相应代码块来切换轨迹

##### 功能特性

###### 轨迹生成器

8字形轨迹：使用参数方程生成8字形路径



圆形轨迹：可配置圆心和半径的圆形路径



螺旋轨迹：可配置圈数和缩放因子的螺旋路径



直线轨迹：简单的直线路径



###### MPC控制器特性

支持预测时域和代价函数权重配置



包含控制量约束和变化率约束



内置热启动和求解器优化



控制缓冲机制处理求解失败情况



横向偏差计算提高跟踪精度



###### 可视化功能

实时绘制参考轨迹（绿色）



实时绘制预测轨迹（红色）



鸟瞰视角观察车辆运动



###### 调试和调优

###### 常见问题

Carla连接失败：确保Carla服务器正在运行，且Python API路径正确



MPC求解失败：调整config.py中的权重系数，或增加求解时间限制



车辆控制不稳定：调整dt控制周期或减少控制量限制



###### 性能调优

调整N（预测时域）：影响计算复杂度和预测能力



调整代价函数权重：平衡跟踪精度和控制平滑性



调整dt：控制频率，影响实时性和计算负荷



###### 输出数据

程序运行时会记录：



车辆状态（位置、速度、航向角）



参考轨迹信息



控制输出（方向盘、油门、刹车）



MPC计算时间



##### 注意事项

确保Carla版本与Python API版本匹配



首次运行可能需要较长时间编译CasADi优化问题



建议在性能较好的计算机上运行，确保实时性



可调整config.py中的参数以适应不同的跟踪需求



##### 许可证

本项目仅供学习和研究使用，请遵守Carla仿真器的相关使用条款。



##### 参考

https://github.com/Slimercorp/MPC-Carla

