# CARLA Manual Control 代码优化说明文档

## 一、优化概述
这次主要是改了 CARLA 官方的 manual_control.py 脚本，没动原来的功能，就是让代码看着更清楚、改起来更方便，也少了点小问题。

## 二、核心优化点明细

### 1. 代码结构重构：模块化拆分
原来的代码我发现好多功能混在一起，找个东西得翻半天。现在按功能拆开了：
工具类：专门找 CARLA 的依赖文件、拿角色蓝图这些通用操作
传感器类：把碰撞检测、GNSS 这些传感器单独写成类，初始化和数据处理不用再跟别的代码混着
UI 相关：HUD 显示、提示文字这些单独管，想改界面不用动别的逻辑
控制类：就管键盘输入和车辆控制，跟显示、传感器分开


### 2. 可读性提升：规范与清晰化
变量名改了：原来的 t、v、c 这种看不懂的，改成 transform、velocity、control，一眼能看明白
加了注释：每个类和主要函数都写了是干啥的，复杂点的计算步骤也标了说明


### 3. 性能优化：效率与资源管控
#### （1）数据结构优化
- 碰撞历史存储：原代码使用列表 `list` 存储碰撞历史，删除头部元素时效率低（时间复杂度 O(n)），优化为 `collections.deque`（双端队列），头部删除效率提升至 O(1)。
- 雷达数据处理：减少冗余计算，仅在需要可视化时解析雷达点云，避免不必要的内存占用。

#### （2）资源管理优化
- 传感器销毁逻辑：原代码传感器销毁分散在多个地方，优化后统一到 `World.destroy` 方法，确保程序退出时所有传感器（相机/雷达/GNSS）都能被正确销毁，避免CARLA服务器资源泄漏。
- 同步模式适配：在 `main` 函数 `finally` 块中添加同步模式恢复逻辑，即使程序异常退出，也能将CARLA世界恢复为异步模式，避免影响后续使用。

#### （3）重复计算消除
换了存储方式：原来存碰撞记录用列表，删东西慢，现在用 deque，删起来快多了



